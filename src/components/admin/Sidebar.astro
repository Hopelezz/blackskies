---
// components/admin/Sidebar.astro
import { supabase } from "../../lib/supabase";

const { profile: userProfile } = Astro.props;

// Get current path for active state
const currentPath = Astro.url.pathname;

// Check if the user is an admin
const profile = userProfile || null;

const isAdmin = profile?.role === "admin";

const menuItems = [
  {
    name: "Dashboard",
    href: "/admin/dashboard",
    icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>`
  },
  {
    name: "Posts",
    href: "/admin/posts",
    icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15M9 11l3 3m0 0l3-3m-3 3V8" />
          </svg>`
  },
  {
    name: "Profile",
    href: "/admin/profile",
    icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>`
  }
];

// Add admin-only menu items
if (isAdmin) {
  menuItems.push({
    name: "Create Test Account",
    href: "/admin/create-test-account",
    icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
          </svg>`
  },
  {
    name: "Users",
    href: "/admin/users",
    icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
          </svg>`
  },
  {
    name: "Settings",
    href: "/admin/settings",
    icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
          </svg>`
  });
}


---

<aside
  id="logo-sidebar"
  class="fixed left-0 top-0 z-40 h-screen w-64 -translate-x-full border-r border-skin-line bg-skin-fill pt-20 transition-transform sm:translate-x-0"
  aria-label="Sidebar"
>
  <div class="h-full overflow-y-auto px-3 pb-4">
    <ul class="space-y-2 font-medium">
      {menuItems.map(item => (
        <li>
          <a
            href={item.href}
            class:list={[
              "flex items-center rounded-lg p-2 text-skin-base hover:bg-skin-card-muted",
              { "bg-skin-card text-skin-accent": currentPath === item.href }
            ]}
          >
            <Fragment set:html={item.icon} />
            <span class="ml-3">{item.name}</span>
          </a>
        </li>
      ))}
    </ul>
  </div>
</aside>

<script>
  // Initialize Flowbite sidebar functionality
  import { initFlowbite } from "flowbite";
  initFlowbite();
</script>